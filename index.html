<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FÃ¼chse Berlin Statistik</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        text-align: center;
        background: url('75067C70-07BC-48ED-B437-9624E46CFE65.jpeg') center center no-repeat;
        background-size: 60%;
        background-attachment: fixed;
        background-color: #ffffff;
        background-blend-mode: lighten;
    }
    header {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        background-color: #004c2c;
        color: white;
        font-size: 1.5em;
    }
    header img {
        height: 40px;
        margin-right: 10px;
    }
    .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        margin: 15px;
    }
    .player-card {
        background-color: white;
        border-radius: 8px;
        padding: 10px;
        width: 250px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    h2 {
        font-size: 1.2em;
        margin: 5px 0 10px 0;
    }
    .section-title {
        font-weight: bold;
        font-size: 0.9em;
        margin: 5px 0;
        background-color: #004c2c;
        color: white;
        padding: 3px;
        border-radius: 5px;
    }
    .button-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 5px;
    }
    button {
        padding: 10px;
        font-size: 1em;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        color: #004c2c;
    }
    .positive { background-color: #c8e6c9; }
    .negative { background-color: #ffcdd2; }
    .full-width { grid-column: span 2; }
    .divider {
        border-top: 3px solid black;
        margin: 5px 0;
    }
    .export-btns {
        margin: 15px;
    }
    .export-btns button {
        margin: 5px;
        background-color: #004c2c;
        color: white;
        padding: 10px 15px;
    }
</style>
</head>
<body>

<!-- Startseite mit Gegnerauswahl -->
<div id="start-screen">
    <header>
        <img src="75067C70-07BC-48ED-B437-9624E46CFE65.jpeg" alt="Logo">
        Gegner eingeben
    </header>
    <div style="margin:20px;">
        <input type="text" id="opponent" placeholder="Gegnername eingeben" style="padding:10px;width:80%;font-size:1em;">
        <br><br>
        <button style="background-color:#004c2c;color:white;padding:10px 20px;" onclick="startMatch()">Weiter</button>
    </div>
</div>

<!-- Statistikseite -->
<div id="stats-screen" style="display:none;">
    <header>
        <img src="75067C70-07BC-48ED-B437-9624E46CFE65.jpeg" alt="Logo">
        <span id="headline">Statistik</span>
    </header>

    <div class="container" id="players-container"></div>

    <div class="export-btns">
        <button onclick="exportCSV()">Export CSV</button>
        <button onclick="exportJSON()">Export JSON</button>
    </div>
</div>

<script>
const players = Array.from({length: 20}, (_, i) => `Spieler ${i+1}`);
const actionsPositive = ["KM", "DBR", "NAH", "FERN", "TGS", "7M"];
const actionsNegative = ["KM", "DBR", "NAH", "FERN", "TGS", "7M", "TF"];
let stats = {};

players.forEach(player => {
    stats[player] = {};
    [...actionsPositive, ...actionsNegative].forEach(action => stats[player][action] = 0);
});

function startMatch() {
    const opponent = document.getElementById("opponent").value || "Unbekannt";
    document.getElementById("headline").innerText = `Statistik vs ${opponent}`;
    document.getElementById("start-screen").style.display = "none";
    document.getElementById("stats-screen").style.display = "block";
    renderPlayers();
}

function renderPlayers() {
    const container = document.getElementById("players-container");
    container.innerHTML = "";
    players.forEach(player => {
        const card = document.createElement("div");
        card.className = "player-card";

        const title = document.createElement("h2");
        title.textContent = player;
        card.appendChild(title);

        const posTitle = document.createElement("div");
        posTitle.className = "section-title";
        posTitle.textContent = "Positive Aktionen";
        card.appendChild(posTitle);

        const posGrid = document.createElement("div");
        posGrid.className = "button-grid";
        actionsPositive.forEach(action => {
            const btn = document.createElement("button");
            btn.className = "positive";
            btn.innerText = `${action} (${stats[player][action]})`;
            btn.addEventListener("click", () => updateStat(player, action, 1));
            btn.addEventListener("contextmenu", e => { e.preventDefault(); updateStat(player, action, -1); });
            btn.addEventListener("mousedown", e => { if (e.buttons === 1) longPress(btn, player, action); });
            posGrid.appendChild(btn);
        });
        card.appendChild(posGrid);

        const divider = document.createElement("div");
        divider.className = "divider";
        card.appendChild(divider);

        const negTitle = document.createElement("div");
        negTitle.className = "section-title";
        negTitle.textContent = "Negative Aktionen";
        card.appendChild(negTitle);

        const negGrid = document.createElement("div");
        negGrid.className = "button-grid";
        actionsNegative.forEach(action => {
            const btn = document.createElement("button");
            btn.className = "negative" + (action === "TF" ? " full-width" : "");
            btn.innerText = `${action} (${stats[player][action]})`;
            btn.addEventListener("click", () => updateStat(player, action, 1));
            btn.addEventListener("contextmenu", e => { e.preventDefault(); updateStat(player, action, -1); });
            btn.addEventListener("mousedown", e => { if (e.buttons === 1) longPress(btn, player, action); });
            negGrid.appendChild(btn);
        });
        card.appendChild(negGrid);

        container.appendChild(card);
    });
}

function updateStat(player, action, delta) {
    stats[player][action] = Math.max(0, stats[player][action] + delta);
    renderPlayers();
}

function longPress(btn, player, action) {
    let pressTimer = setTimeout(() => {
        if (stats[player][action] > 0) {
            stats[player][action]--;
            renderPlayers();
        }
    }, 600);
    btn.onmouseup = () => clearTimeout(pressTimer);
}

function exportCSV() {
    let csv = "Spieler," + [...actionsPositive, ...actionsNegative].join(",") + "\n";
    players.forEach(player => {
        csv += player + "," + [...actionsPositive, ...actionsNegative].map(a => stats[player][a]).join(",") + "\n";
    });
    downloadFile(csv, "statistik.csv", "text/csv");
}

function exportJSON() {
    downloadFile(JSON.stringify(stats), "statistik.json", "application/json");
}

function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
