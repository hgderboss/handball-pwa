<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handball Statistik</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0; padding: 0;
        background-color: #f8f8f8;
    }
    header {
        display: flex;
        align-items: center;
        padding: 10px;
        background-color: white;
        border-bottom: 2px solid #ccc;
    }
    header img {
        height: 40px;
        margin-right: 10px;
    }
    h1 {
        font-size: 1.5em;
        margin: 0;
    }
    .container {
        padding: 10px;
    }
    .player {
        border-bottom: 1px solid #ccc;
        padding: 10px 0;
    }
    .player-name {
        font-weight: bold;
        font-size: 1.2em;
        margin-bottom: 5px;
    }
    .button-row {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 5px;
    }
    button {
        flex: 1;
        padding: 10px;
        font-size: 1em;
        border: none;
        border-radius: 5px;
        color: white;
    }
    .positive { background-color: #6bbf73; }
    .negative { background-color: #e57373; }
    .double { flex: 2; }
    .stats {
        margin-top: 20px;
        background: white;
        padding: 10px;
        border-radius: 5px;
    }
    .stats h2 {
        font-size: 1.3em;
        margin-top: 0;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 5px;
        text-align: center;
    }
    th {
        background: #eee;
    }
    .export-buttons {
        margin-top: 10px;
        display: flex;
        gap: 10px;
    }
</style>
</head>
<body>

<header>
    <img src="logo.png.JPG" alt="Vereinslogo">
    <h1 id="headline">Statistik vs Gegner</h1>
</header>

<div class="container" id="setup">
    <h2>Gegnername eingeben:</h2>
    <input type="text" id="opponent" placeholder="Gegnername">
    <h2>Spieler ausw√§hlen:</h2>
    <div id="playerSelection"></div>
    <button onclick="startGame()">Start</button>
</div>

<div class="container" id="game" style="display:none;"></div>

<div class="container stats" id="stats" style="display:none;">
    <h2>Spielerstatistik</h2>
    <div id="playerStats"></div>
    <h2>Teamstatistik</h2>
    <div id="teamStats"></div>
    <div class="export-buttons">
        <button onclick="exportExcel()">Export Excel</button>
        <button onclick="exportPDF()">Export PDF</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const players = Array.from({length:20},(_,i)=>`Spieler ${i+1}`);
let selectedPlayers = [];
let stats = {};
const actionsPos = ["KM","DBR","NAH","FERN","TGS","7M"];
const actionsNeg = ["KM","DBR","NAH","FERN","TGS","7M","TF"];

function buildPlayerSelection() {
    const container = document.getElementById("playerSelection");
    players.forEach(name=>{
        const label = document.createElement("label");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.value = name;
        label.appendChild(cb);
        label.append(" " + name);
        container.appendChild(label);
        container.appendChild(document.createElement("br"));
    });
}
buildPlayerSelection();

function startGame(){
    const opponent = document.getElementById("opponent").value || "Gegner";
    document.getElementById("headline").innerText = `Statistik vs ${opponent}`;
    selectedPlayers = Array.from(document.querySelectorAll("#playerSelection input:checked")).map(cb=>cb.value);
    selectedPlayers.forEach(p=>{
        stats[p] = {pos:{},neg:{}};
        actionsPos.forEach(a=>stats[p].pos[a]=0);
        actionsNeg.forEach(a=>stats[p].neg[a]=0);
    });
    document.getElementById("setup").style.display="none";
    document.getElementById("game").style.display="block";
    renderGame();
}

function renderGame(){
    const game = document.getElementById("game");
    game.innerHTML = "";
    selectedPlayers.forEach(player=>{
        const div = document.createElement("div");
        div.className = "player";
        div.innerHTML = `<div class="player-name">${player}</div>`;
        
        const posRow = document.createElement("div");
        posRow.className = "button-row";
        actionsPos.forEach(a=>{
            const btn = document.createElement("button");
            btn.className = "positive";
            btn.innerText = `${a} (${stats[player].pos[a]})`;
            btn.addEventListener("click",()=>{stats[player].pos[a]++; btn.innerText=`${a} (${stats[player].pos[a]})`; updateStats();});
            btn.addEventListener("contextmenu", e => e.preventDefault());
            btn.addEventListener("touchstart", e => {
                this.touchTimer = setTimeout(() => { if(stats[player].pos[a]>0) stats[player].pos[a]--; btn.innerText=`${a} (${stats[player].pos[a]})`; updateStats(); }, 500);
            });
            btn.addEventListener("touchend", e => clearTimeout(this.touchTimer));
            posRow.appendChild(btn);
        });
        
        const negRow = document.createElement("div");
        negRow.className = "button-row";
        actionsNeg.forEach(a=>{
            const btn = document.createElement("button");
            btn.className = "negative" + (a==="TF" ? " double" : "");
            btn.innerText = `${a} (${stats[player].neg[a]})`;
            btn.addEventListener("click",()=>{stats[player].neg[a]++; btn.innerText=`${a} (${stats[player].neg[a]})`; updateStats();});
            btn.addEventListener("touchstart", e => {
                this.touchTimer = setTimeout(() => { if(stats[player].neg[a]>0) stats[player].neg[a]--; btn.innerText=`${a} (${stats[player].neg[a]})`; updateStats(); }, 500);
            });
            btn.addEventListener("touchend", e => clearTimeout(this.touchTimer));
            negRow.appendChild(btn);
        });

        div.appendChild(posRow);
        div.appendChild(negRow);
        game.appendChild(div);
    });
    updateStats();
}

function updateStats(){
    document.getElementById("stats").style.display="block";
    let playerStatsHTML = "<table><tr><th>Spieler</th>";
    actionsPos.concat(actionsNeg).forEach(a=>playerStatsHTML+=`<th>${a}</th>`);
    playerStatsHTML+="</tr>";
    selectedPlayers.forEach(p=>{
        playerStatsHTML += `<tr><td>${p}</td>`;
        actionsPos.forEach(a=>playerStatsHTML+=`<td>${stats[p].pos[a]}</td>`);
        actionsNeg.forEach(a=>playerStatsHTML+=`<td>${stats[p].neg[a]}</td>`);
        playerStatsHTML+="</tr>";
    });
    playerStatsHTML+="</table>";
    document.getElementById("playerStats").innerHTML = playerStatsHTML;

    let teamStats = {};
    actionsPos.concat(actionsNeg).forEach(a=>teamStats[a]=0);
    selectedPlayers.forEach(p=>{
        actionsPos.forEach(a=>teamStats[a]+=stats[p].pos[a]);
        actionsNeg.forEach(a=>teamStats[a]+=stats[p].neg[a]);
    });
    let teamStatsHTML = "<table><tr>";
    actionsPos.concat(actionsNeg).forEach(a=>teamStatsHTML+=`<th>${a}</th>`);
    teamStatsHTML+="</tr><tr>";
    actionsPos.concat(actionsNeg).forEach(a=>teamStatsHTML+=`<td>${teamStats[a]}</td>`);
    teamStatsHTML+="</tr></table>";
    document.getElementById("teamStats").innerHTML = teamStatsHTML;
}

function exportExcel(){
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.table_to_sheet(document.querySelector("#playerStats table"));
    XLSX.utils.book_append_sheet(wb, ws, "Spielerstatistik");
    XLSX.writeFile(wb, "statistik.xlsx");
}

async function exportPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Spielerstatistik", 10, 10);
    doc.text(document.getElementById("playerStats").innerText, 10, 20);
    doc.save("statistik.pdf");
}
</script>

</body>
</html>
