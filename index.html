<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistik vs Gegner</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header, .setup { padding: 10px; text-align: center; background: #eee; }
    h1 { font-size: 1.5em; margin: 0; }
    .players { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 10px; }
    .player-card { border: 1px solid #ccc; border-radius: 8px; padding: 5px; min-width: 220px; text-align: center; background: #f9f9f9; }
    .button-row { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; justify-content: center; }
    button { flex: 1 1 calc(33% - 5px); min-width: 60px; padding: 10px; font-size: 1em; border-radius: 5px; border: none; cursor: pointer; }
    .positive { background: #c8e6c9; }
    .negative { background: #ffcdd2; }
    .stats { padding: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
    th { background: #f0f0f0; }
</style>
</head>
<body>

<div class="setup">
    <label>Gegner: <input type="text" id="opponent"></label>
    <div id="player-select"></div>
    <button onclick="startGame()">Start</button>
</div>

<header>
    <h1 id="headline">Statistik vs ...</h1>
</header>

<div class="players" id="players"></div>

<div class="stats" id="stats"></div>

<script>
const allPlayers = Array.from({length: 20}, (_, i) => `Spieler ${i+1}`);
let selectedPlayers = [];
let opponentName = "";
let stats = {};

const positiveActions = ["KM", "DBR", "NAH", "FERN", "TGS", "7M"];
const negativeActions = ["KM", "DBR", "NAH", "FERN", "TGS", "7M", "TF"];

function initPlayerSelect() {
    const container = document.getElementById('player-select');
    allPlayers.forEach(name => {
        const label = document.createElement('label');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.value = name;
        label.appendChild(cb);
        label.append(` ${name} `);
        container.appendChild(label);
    });
}
initPlayerSelect();

function startGame() {
    opponentName = document.getElementById('opponent').value || "Unbekannt";
    selectedPlayers = Array.from(document.querySelectorAll('#player-select input:checked')).map(cb => cb.value);
    document.getElementById('headline').textContent = `Statistik vs ${opponentName}`;
    initStats();
    renderPlayers();
    renderStats();
}

function initStats() {
    stats = {};
    selectedPlayers.forEach(player => {
        stats[player] = {};
        [...positiveActions, ...negativeActions].forEach(a => stats[player][a] = 0);
    });
}

function renderPlayers() {
    const container = document.getElementById('players');
    container.innerHTML = '';
    selectedPlayers.forEach(player => {
        const card = document.createElement('div');
        card.className = 'player-card';
        const name = document.createElement('div');
        name.textContent = player;
        card.appendChild(name);

        const posRow = document.createElement('div');
        posRow.className = 'button-row';
        positiveActions.forEach(action => {
            const btn = createButton(player, action, 'positive');
            posRow.appendChild(btn);
        });
        card.appendChild(posRow);

        const negRow = document.createElement('div');
        negRow.className = 'button-row';
        negativeActions.forEach(action => {
            const btn = createButton(player, action, 'negative');
            negRow.appendChild(btn);
        });
        card.appendChild(negRow);

        container.appendChild(card);
    });
}

function createButton(player, action, type) {
    const btn = document.createElement('button');
    btn.className = type;
    updateButtonLabel(btn, action, stats[player][action]);
    btn.addEventListener('click', () => {
        stats[player][action]++;
        updateButtonLabel(btn, action, stats[player][action]);
        renderStats();
    });
    btn.addEventListener('contextmenu', e => e.preventDefault());
    btn.addEventListener('touchstart', e => {
        btn.longPressTimeout = setTimeout(() => {
            if (stats[player][action] > 0) stats[player][action]--;
            updateButtonLabel(btn, action, stats[player][action]);
            renderStats();
        }, 600);
    });
    btn.addEventListener('touchend', e => clearTimeout(btn.longPressTimeout));
    return btn;
}

function updateButtonLabel(btn, action, count) {
    btn.textContent = `${action} (${count})`;
}

function renderStats() {
    const statsDiv = document.getElementById('stats');
    let html = `<h2>Spieler-Statistik</h2><table><tr><th>Spieler</th>`;
    [...positiveActions, ...negativeActions].forEach(a => html += `<th>${a}</th>`);
    html += `</tr>`;
    selectedPlayers.forEach(player => {
        html += `<tr><td>${player}</td>`;
        [...positiveActions, ...negativeActions].forEach(a => html += `<td>${stats[player][a]}</td>`);
        html += `</tr>`;
    });
    html += `</table>`;

    html += `<h2>Team-Statistik</h2><table><tr><th>Aktion</th><th>Summe</th></tr>`;
    [...positiveActions, ...negativeActions].forEach(a => {
        let sum = selectedPlayers.reduce((acc, p) => acc + stats[p][a], 0);
        html += `<tr><td>${a}</td><td>${sum}</td></tr>`;
    });
    html += `</table>`;

    statsDiv.innerHTML = html;
}
</script>
</body>
</html>
