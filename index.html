<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handball Statistik App</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    h1, h2 { text-align: center; }
    .container { padding: 10px; max-width: 900px; margin: auto; }
    .player-selection { display: flex; flex-wrap: wrap; gap: 10px; }
    .player-card { border: 1px solid #ccc; padding: 5px; width: 140px; }
    .button-row { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
    button { padding: 5px; font-size: 14px; border: none; border-radius: 4px; cursor: pointer; }
    .positive { background-color: #c9e6c9; }
    .negative { background-color: #f5cccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
    #start-btn { padding: 10px 20px; font-size: 16px; margin: 20px auto; display: block; }
</style>
</head>
<body>

<div class="container" id="selection-screen">
    <h1>Kaderauswahl</h1>
    <p>Wähle 7–16 Spieler für das Spiel:</p>
    <div class="player-selection" id="player-selection-list"></div>
    <button id="start-btn">Spiel starten</button>
</div>

<div class="container" id="game-screen" style="display:none;">
    <h1>Handball Statistik</h1>
    <div id="players-area"></div>
    <h2>Team-Statistik</h2>
    <div id="team-stats"></div>
</div>

<script>
const allPlayers = Array.from({length: 20}, (_, i) => `Spieler ${i+1}`);
let gameData = {};

function createSelectionList() {
    const list = document.getElementById('player-selection-list');
    allPlayers.forEach(player => {
        const div = document.createElement('div');
        div.classList.add('player-card');
        div.innerHTML = `<label><input type="checkbox" value="${player}"> ${player}</label>`;
        list.appendChild(div);
    });
}

function startGame() {
    const selected = Array.from(document.querySelectorAll('#player-selection-list input:checked'))
        .map(cb => cb.value);

    if (selected.length < 7 || selected.length > 16) {
        alert('Bitte wähle zwischen 7 und 16 Spielern.');
        return;
    }

    document.getElementById('selection-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';

    selected.forEach(player => {
        gameData[player] = {
            positive: { km: 0, dbr: 0, nah: 0, fern: 0, tgs: 0, siebenm: 0 },
            negative: { km: 0, dbr: 0, nah: 0, fern: 0, tgs: 0, siebenm: 0, tf: 0 }
        };
    });

    renderPlayers(selected);
    updateTeamStats();
}

function renderPlayers(players) {
    const area = document.getElementById('players-area');
    area.innerHTML = '';
    players.forEach(player => {
        const div = document.createElement('div');
        div.classList.add('player-card');
        div.innerHTML = `<h3>${player}</h3>
            <div class="button-row">
                ${createButtons(player, 'positive', ['km','dbr','nah','fern','tgs','siebenm'], 'positive')}
            </div>
            <div class="button-row">
                ${createButtons(player, 'negative', ['km','dbr','nah','fern','tgs','siebenm','tf'], 'negative')}
            </div>
            <div id="stats-${player}"></div>`;
        area.appendChild(div);
    });
}

function createButtons(player, type, actions, cssClass) {
    return actions.map(act => {
        return `<button class="${cssClass}" id="${player}-${type}-${act}" onclick="increment('${player}','${type}','${act}')">${act.toUpperCase()} (0)</button>`;
    }).join('');
}

function increment(player, type, action) {
    gameData[player][type][action]++;
    document.getElementById(`${player}-${type}-${action}`).innerText = `${action.toUpperCase()} (${gameData[player][type][action]})`;
    updateTeamStats();
}

function updateTeamStats() {
    const teamStats = { positive: 0, negative: 0, negativeInclTF: 0 };
    let table = `<table><tr><th>Spieler</th><th>Positiv</th><th>Negativ</th><th>Wurfquote</th><th>Wurfquote inkl. TF</th></tr>`;
    for (const player in gameData) {
        const pos = Object.values(gameData[player].positive).reduce((a,b) => a+b, 0);
        const negNoTF = Object.entries(gameData[player].negative).filter(([k]) => k !== 'tf').reduce((a,[,b]) => a+b, 0);
        const negInclTF = Object.values(gameData[player].negative).reduce((a,b) => a+b, 0);
        const q1 = pos + negNoTF > 0 ? (pos / (pos + negNoTF) * 100).toFixed(1) + '%' : '-';
        const q2 = pos + negInclTF > 0 ? (pos / (pos + negInclTF) * 100).toFixed(1) + '%' : '-';
        table += `<tr><td>${player}</td><td>${pos}</td><td>${negNoTF}</td><td>${q1}</td><td>${q2}</td></tr>`;
        teamStats.positive += pos;
        teamStats.negative += negNoTF;
        teamStats.negativeInclTF += negInclTF;
    }
    const tq1 = teamStats.positive + teamStats.negative > 0 ? (teamStats.positive / (teamStats.positive + teamStats.negative) * 100).toFixed(1) + '%' : '-';
    const tq2 = teamStats.positive + teamStats.negativeInclTF > 0 ? (teamStats.positive / (teamStats.positive + teamStats.negativeInclTF) * 100).toFixed(1) + '%' : '-';
    table += `<tr><th>Team</th><th>${teamStats.positive}</th><th>${teamStats.negative}</th><th>${tq1}</th><th>${tq2}</th></tr>`;
    table += `</table>`;
    document.getElementById('team-stats').innerHTML = table;
}

document.getElementById('start-btn').addEventListener('click', startGame);

createSelectionList();
</script>

</body>
</html>
